<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dream Harbour - Dashboard</title>
    <link rel="stylesheet" href="css/dashboard.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>Dream Harbour</h1>
                <p class="user-name" id="userName">Loading...</p>
            </div>
            
            <nav class="menu">
                <button class="menu-item active" onclick="showSection('home')">
                    üìä Dashboard
                </button>
                <button class="menu-item" onclick="showSection('invoice')">
                    üìÑ Generate Invoice
                </button>
                <button class="menu-item" onclick="showSection('reports')">
                    üìà Reports
                </button>
                <button class="menu-item" onclick="showSection('settings')">
                    ‚öôÔ∏è Settings
                </button>
                <button class="menu-item" onclick="showSection('users')">
                    üë• User Management
                </button>
            </nav>
            
            <button class="logout-btn" onclick="logout()">üö™ Logout</button>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <!-- HEADER -->
            <header class="top-header">
                <h2 id="sectionTitle">Dashboard</h2>
                <div class="header-right">
                    <span id="currentTime"></span>
                </div>
            </header>

            <!-- DASHBOARD SECTION -->
            <section id="home" class="content-section active">
                <div class="cards-grid">
                    <!-- Total Revenue Card -->
                    <div class="card">
                        <div class="card-icon">üí∞</div>
                        <div class="card-content">
                            <p class="card-label">Total Revenue</p>
                            <h3 class="card-value" id="totalRevenue">‚Çπ0</h3>
                        </div>
                    </div>

                    <!-- GST Collected Card -->
                    <div class="card">
                        <div class="card-icon">üìä</div>
                        <div class="card-content">
                            <p class="card-label">GST Collected</p>
                            <h3 class="card-value" id="totalGST">‚Çπ0</h3>
                        </div>
                    </div>

                    <!-- Services Count Card -->
                    <div class="card">
                        <div class="card-icon">üìã</div>
                        <div class="card-content">
                            <p class="card-label">Services Count</p>
                            <h3 class="card-value" id="servicesCount">0</h3>
                        </div>
                    </div>

                    <!-- Customers Count Card -->
                    <div class="card">
                        <div class="card-icon">üë•</div>
                        <div class="card-content">
                            <p class="card-label">Total Customers</p>
                            <h3 class="card-value" id="customersCount">0</h3>
                        </div>
                    </div>
                </div>

                <div class="charts-section">
                    <div class="chart-container">
                        <h3>Revenue by Service</h3>
                        <canvas id="serviceChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Monthly Revenue</h3>
                        <canvas id="monthlyChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- INVOICE SECTION - EMBEDDED -->
            <section id="invoice" class="content-section">
                <div id="invoiceContent" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0; height: calc(100vh - 80px);">
                    <!-- LEFT PANEL - FORM -->
                    <div style="background: white; padding: 30px; overflow-y: auto; border-right: 2px solid #e5e7eb;">
                        <h3 style="color: #1f2937; margin-bottom: 20px;">üìã Customer Details</h3>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">Mobile Number *</label>
                            <div style="display: grid; grid-template-columns: 1fr auto; gap: 10px;">
                                <input type="tel" id="mobileNumber" placeholder="Enter 10-digit mobile" maxlength="10" style="padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 0.9rem;">
                                <button onclick="searchCustomer()" style="background: #3b82f6; color: white; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; font-weight: 500;">Search</button>
                            </div>
                            <div id="existingCustomers" style="display: none; margin-top: 10px; padding: 10px; background: #f0f9ff; border-radius: 6px; border: 1px solid #bfdbfe;"></div>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">Full Name *</label>
                            <input type="text" id="fullName" placeholder="Customer full name" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 0.9rem;">
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">Email</label>
                            <input type="email" id="email" placeholder="customer@example.com" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 0.9rem;">
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">GSTIN</label>
                            <input type="text" id="gstin" placeholder="GSTIN (optional)" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 0.9rem;">
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">Address</label>
                            <textarea id="address" placeholder="Complete address" rows="2" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 0.9rem; font-family: inherit;"></textarea>
                        </div>

                        <hr style="margin: 20px 0; border: none; border-top: 1px solid #e5e7eb;">

                        <h3 style="color: #1f2937; margin-bottom: 20px;">üõçÔ∏è Services</h3>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">Select Service *</label>
                            <div style="display: grid; grid-template-columns: 1fr auto; gap: 10px;">
                                <select id="serviceType" style="padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 0.9rem;">
                                    <option value="">-- Select a Service --</option>
                                </select>
                                <button onclick="addService()" style="background: #10b981; color: white; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; font-weight: 500;">+ Add</button>
                            </div>
                        </div>

                        <div id="servicesList" style="margin-bottom: 20px;"></div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 30px;">
                            <button onclick="generateInvoice()" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; border: none; padding: 12px 20px; border-radius: 6px; font-weight: 600; cursor: pointer;">Generate Invoice</button>
                            <button onclick="clearInvoiceForm()" style="background: #e5e7eb; color: #374151; border: none; padding: 12px 20px; border-radius: 6px; font-weight: 600; cursor: pointer;">Clear</button>
                        </div>
                    </div>

                    <!-- RIGHT PANEL - PREVIEW -->
                    <div style="background: #f5f7fa; padding: 30px; overflow-y: auto;">
                        <div class="invoice-preview" id="invoicePreview" style="background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                            <div style="text-align: center; margin-bottom: 30px; border-bottom: 2px solid #1e40af; padding-bottom: 15px;">
                                <h1 style="color: #1e40af; margin-bottom: 5px; font-size: 1.8rem;">Dream Harbour</h1>
                                <p style="color: #6b7280; font-size: 1.2rem;">Invoice</p>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                                <div style="font-size: 0.85rem; color: #374151;">
                                    <h4 style="color: #1f2937; margin-bottom: 8px; font-size: 0.9rem;">Bill To:</h4>
                                    <p id="previewName" style="margin-bottom: 5px;">-</p>
                                    <p id="previewMobile" style="margin-bottom: 5px;">-</p>
                                    <p id="previewGstin" style="margin-bottom: 5px;">-</p>
                                    <p id="previewAddress" style="word-break: break-word; line-height: 1.5;">-</p>
                                </div>
                                <div style="font-size: 0.85rem; color: #374151; text-align: right;">
                                    <p style="margin-bottom: 5px;"><strong>Invoice #:</strong> <span id="previewInvoiceNo">-</span></p>
                                    <p style="margin-bottom: 5px;"><strong>Date:</strong> <span id="previewDate">-</span></p>
                                </div>
                            </div>

                            <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 0.75rem;">
                                <thead style="background: #f3f4f6;">
                                    <tr>
                                        <th style="padding: 8px 4px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #d1d5db;">#</th>
                                        <th style="padding: 8px 4px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #d1d5db;">Service</th>
                                        <th style="padding: 8px 4px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #d1d5db;">SAC</th>
                                        <th style="padding: 8px 4px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #d1d5db;">Qty</th>
                                        <th style="padding: 8px 4px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #d1d5db;">Rate</th>
                                        <th style="padding: 8px 4px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #d1d5db;">Amt</th>
                                        <th style="padding: 8px 4px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #d1d5db;">GST%</th>
                                        <th style="padding: 8px 4px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #d1d5db;">GST</th>
                                        <th style="padding: 8px 4px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #d1d5db;">Total</th>
                                    </tr>
                                </thead>
                                <tbody id="invoiceTableBody"></tbody>
                            </table>

                            <div style="background: #f9fafb; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; padding: 8px 0; font-size: 0.9rem; color: #374151;">
                                    <span>Subtotal:</span>
                                    <span id="previewSubtotal">‚Çπ0.00</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 8px 0; font-size: 0.9rem; color: #374151;">
                                    <span>Total GST:</span>
                                    <span id="previewTotalGst">‚Çπ0.00</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 12px 0; border-top: 2px solid #d1d5db; margin-top: 8px; font-size: 1.1rem; font-weight: 600; color: #1f2937;">
                                    <span>Grand Total:</span>
                                    <span id="previewGrandTotal">‚Çπ0.00</span>
                                </div>
                            </div>

                            <div style="text-align: center; color: #6b7280; font-size: 0.85rem; margin-bottom: 20px; padding: 15px 0; border-top: 1px solid #e5e7eb;">
                                <p>Thank you for your business!</p>
                            </div>

                            <div style="text-align: center;">
                                <button onclick="printInvoice()" style="margin: 10px 5px; padding: 10px 15px; background: #60a5fa; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 500;">üñ®Ô∏è Print</button>
                                <button onclick="downloadInvoicePDF()" style="margin: 10px 5px; padding: 10px 15px; background: #34d399; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 500;">‚¨áÔ∏è Download PDF</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- REPORTS SECTION -->
            <section id="reports" class="content-section">
                <div class="reports-container">
                    <h3>Reports & Analytics</h3>
                    <p style="color: #999; margin: 20px 0;">Coming Soon - Reports will be available here</p>
                </div>
            </section>

            <!-- SETTINGS SECTION -->
            <section id="settings" class="content-section">
                <div class="settings-container">
                    <h3>Business Settings</h3>
                    <p style="color: #999; margin: 20px 0;">Coming Soon - Settings will be available here</p>
                </div>
            </section>

            <!-- USER MANAGEMENT SECTION -->
            <section id="users" class="content-section">
                <div class="users-container">
                    <h3>User Management</h3>
                    <p style="color: #999; margin: 20px 0;">Coming Soon - User management will be available here</p>
                </div>
            </section>
        </main>
    </div>

    <!-- Supabase JS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Chart.js for charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    
    <!-- Our configuration file -->
    <script src="js/supabase-config.js"></script>
    
    <!-- Dashboard logic -->
    <script src="js/dashboard.js"></script>

    <!-- Invoice logic -->
    <script src="js/invoice.js"></script>
</body>
</html>
